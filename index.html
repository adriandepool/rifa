<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Rifas</title>
    
    <!-- Estilos: Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fuentes -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- Librer√≠as de React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Compilador Babel (para JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Iconos Lucide -->
    <script src="https://unpkg.com/lucide@0.292.0/dist/umd/lucide.min.js"></script>
    
    <!-- HTML2Canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; }
        .animate-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        
        /* Clase especial para forzar centrado en html2canvas */
        .center-fix {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            width: 100%;
            padding-top: 2px; /* Peque√±o ajuste visual para la fuente Inter */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icon = ({ name, size = 24, className, ...props }) => {
            const iconData = window.lucide?.icons?.[name];
            if (!iconData) return null;
            const [tag, attrs, children] = iconData;
            return (
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width={size}
                    height={size}
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    strokeWidth="2"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    className={className}
                    {...props}
                    {...attrs}
                >
                    {children.map(([childTag, childAttrs], i) => 
                        React.createElement(childTag, { ...childAttrs, key: i })
                    )}
                </svg>
            );
        };

        const Settings = (p) => <Icon name="Settings" {...p} />;
        const User = (p) => <Icon name="User" {...p} />;
        const X = (p) => <Icon name="X" {...p} />;
        const Check = (p) => <Icon name="Check" {...p} />;
        const Share2 = (p) => <Icon name="Share2" {...p} />;
        const Trash2 = (p) => <Icon name="Trash2" {...p} />;
        const Edit3 = (p) => <Icon name="Edit3" {...p} />;
        const Download = (p) => <Icon name="Download" {...p} />;
        const Loader2 = (p) => <Icon name="Loader2" {...p} />;
        const Wallet = (p) => <Icon name="Wallet" {...p} />;
        const Save = (p) => <Icon name="Save" {...p} />;
        const Upload = (p) => <Icon name="Upload" {...p} />;
        const Trophy = (p) => <Icon name="Trophy" {...p} />;
        const Plus = (p) => <Icon name="Plus" {...p} />;
        const Calendar = (p) => <Icon name="Calendar" {...p} />;
        const CreditCard = (p) => <Icon name="CreditCard" {...p} />;
        const ChevronDown = (p) => <Icon name="ChevronDown" {...p} />;
        const ChevronUp = (p) => <Icon name="ChevronUp" {...p} />;
        const Lock = (p) => <Icon name="Lock" {...p} />;
        const Unlock = (p) => <Icon name="Unlock" {...p} />;

        const RifaApp = () => {
            const [range, setRange] = useState({ min: 340, max: 379 });
            const [title, setTitle] = useState("Gran Rifa üî•");
            const [priceLabel, setPriceLabel] = useState(""); 
            const [ticketValue, setTicketValue] = useState(0); 
            const [drawDate, setDrawDate] = useState(""); 
            const [bankAlias, setBankAlias] = useState(""); 
            const [prizes, setPrizes] = useState([""]);
            const [sales, setSales] = useState({});
            const [selectedNumber, setSelectedNumber] = useState(null);
            const [buyerName, setBuyerName] = useState("");
            const [viewMode, setViewMode] = useState('admin');
            const [isDownloading, setIsDownloading] = useState(false);
            const [showConfig, setShowConfig] = useState(false);
            
            const cardRef = useRef(null);
            const fileInputRef = useRef(null);

            useEffect(() => {
                const savedData = localStorage.getItem('rifaData');
                if (savedData) {
                    try {
                        const parsed = JSON.parse(savedData);
                        setRange(parsed.range || { min: 340, max: 379 });
                        setSales(parsed.sales || {});
                        setTitle(parsed.title || "Gran Rifa üî•");
                        setPriceLabel(parsed.priceLabel || parsed.price || ""); 
                        setTicketValue(parsed.ticketValue || 0);
                        setPrizes(parsed.prizes || [""]);
                        setDrawDate(parsed.drawDate || "");
                        setBankAlias(parsed.bankAlias || "");
                    } catch (e) {
                        console.error("Error cargando datos", e);
                    }
                }
            }, []);

            useEffect(() => {
                localStorage.setItem('rifaData', JSON.stringify({ range, sales, title, priceLabel, ticketValue, prizes, drawDate, bankAlias }));
                document.title = `${title} - Gestor de Rifas`; 
            }, [range, sales, title, priceLabel, ticketValue, prizes, drawDate, bankAlias]);

            const handleAddPrize = () => {
                if (prizes.length < 5) setPrizes([...prizes, ""]);
            };

            const handleRemovePrize = (index) => {
                const newPrizes = prizes.filter((_, i) => i !== index);
                setPrizes(newPrizes);
            };

            const handlePrizeChange = (index, value) => {
                const newPrizes = [...prizes];
                newPrizes[index] = value;
                setPrizes(newPrizes);
            };

            const generateNumbers = () => {
                const numbers = [];
                const limit = Math.min(range.max - range.min + 1, 500); 
                for (let i = 0; i < limit; i++) {
                    numbers.push(parseInt(range.min) + i);
                }
                return numbers;
            };

            const numbersList = generateNumbers();
            const salesCount = Object.keys(sales).length;
            const totalRevenue = salesCount * (Number(ticketValue) || 0);

            const formatNumber = (num) => {
                return num.toString().padStart(Math.max(range.max.toString().length, 4), '0');
            };

            const handleNumberClick = (num) => {
                setSelectedNumber(num);
                setBuyerName(sales[num] || "");
            };

            const handleSaveSale = (e) => {
                e.preventDefault();
                if (buyerName.trim() === "") return;
                setSales(prev => ({ ...prev, [selectedNumber]: buyerName }));
                setSelectedNumber(null);
                setBuyerName("");
            };

            const handleDeleteSale = () => {
                const newSales = { ...sales };
                delete newSales[selectedNumber];
                setSales(newSales);
                setSelectedNumber(null);
                setBuyerName("");
            };

            const handleReset = () => {
                if (confirm("¬øEst√°s seguro de borrar todos los datos y ventas?")) {
                    setSales({});
                }
            };

            const handleExportData = () => {
                const dataStr = JSON.stringify({ range, sales, title, priceLabel, ticketValue, prizes, drawDate, bankAlias }, null, 2);
                const blob = new Blob([dataStr], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.href = url;
                link.download = `backup-rifa-${new Date().toISOString().slice(0,10)}.json`;
                link.click();
                URL.revokeObjectURL(url);
            };

            const handleImportClick = () => {
                fileInputRef.current.click();
            };

            const handleImportData = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        if (confirm("Esto reemplazar√° los datos actuales. ¬øContinuar?")) {
                            if(importedData.range) setRange(importedData.range);
                            if(importedData.sales) setSales(importedData.sales);
                            if(importedData.title) setTitle(importedData.title);
                            if(importedData.priceLabel) setPriceLabel(importedData.priceLabel);
                            if(importedData.ticketValue) setTicketValue(importedData.ticketValue);
                            if(importedData.prizes) setPrizes(importedData.prizes);
                            if(importedData.drawDate) setDrawDate(importedData.drawDate);
                            if(importedData.bankAlias) setBankAlias(importedData.bankAlias);
                            alert("¬°Datos cargados correctamente!");
                        }
                    } catch (error) {
                        alert("Error al leer el archivo.");
                    }
                };
                reader.readAsText(file);
                event.target.value = null; 
            };

            const handleDownloadImage = async () => {
                setIsDownloading(true);
                const previousMode = viewMode;
                setViewMode('preview');
                await new Promise(resolve => setTimeout(resolve, 500)); // Un poco m√°s de tiempo para asegurar renderizado

                try {
                    if (cardRef.current && window.html2canvas) {
                        const canvas = await window.html2canvas(cardRef.current, {
                            scale: 2,
                            backgroundColor: null, 
                            useCORS: true,
                            logging: false,
                            allowTaint: true,
                            scrollX: 0,
                            scrollY: 0,
                            // Opciones adicionales para estabilidad
                            onclone: (clonedDoc) => {
                                // Asegurar que el elemento clonado sea visible
                                const clonedCard = clonedDoc.querySelector('[data-card-root]');
                                if(clonedCard) clonedCard.style.display = 'block';
                            }
                        });

                        const image = canvas.toDataURL("image/png");
                        const link = document.createElement("a");
                        link.href = image;
                        link.download = `Rifa-${title.replace(/\s+/g, '-')}.png`;
                        link.click();
                    }
                } catch (error) {
                    console.error("Error al descargar imagen:", error);
                    alert("Hubo un error al generar la imagen.");
                } finally {
                    setIsDownloading(false);
                }
            };

            return (
                <div className="min-h-screen bg-gray-100 p-4 font-sans text-gray-800">
                    <div className="max-w-4xl mx-auto flex flex-col md:flex-row gap-6">
                        
                        {/* Panel de Control */}
                        <div className="w-full md:w-1/3 space-y-4">
                            
                            <div className="bg-white p-4 rounded-2xl shadow-md border-l-4 border-green-500 flex justify-between items-center">
                                <div>
                                    <p className="text-xs font-bold text-gray-500 uppercase flex items-center gap-1">
                                        <Wallet size={14} className="text-green-600"/> Recaudado
                                    </p>
                                    <p className="text-2xl font-bold text-green-700 mt-1">
                                        ${totalRevenue.toLocaleString()}
                                    </p>
                                </div>
                                <div className="text-right">
                                    <p className="text-xs text-gray-400">Vendidos</p>
                                    <p className="text-lg font-bold text-indigo-600">{salesCount} <span className="text-xs text-gray-400 font-normal">/ {numbersList.length}</span></p>
                                </div>
                            </div>

                            <button 
                                onClick={() => setShowConfig(!showConfig)}
                                className={`w-full py-3 px-4 rounded-xl flex items-center justify-between font-bold transition-all ${showConfig ? 'bg-gray-200 text-gray-700' : 'bg-white text-indigo-600 shadow-md hover:bg-gray-50'}`}
                            >
                                <span className="flex items-center gap-2">
                                    {showConfig ? <Unlock size={18}/> : <Lock size={18}/>}
                                    {showConfig ? 'Cerrar Configuraci√≥n' : 'Abrir Configuraci√≥n'}
                                </span>
                                {showConfig ? <ChevronUp size={20}/> : <ChevronDown size={20}/>}
                            </button>

                            {showConfig && (
                                <div className="bg-white p-6 rounded-2xl shadow-lg animate-in">
                                    <h2 className="text-xl font-bold mb-4 flex items-center gap-2 text-indigo-600 border-b pb-2">
                                        <Settings size={20} /> Ajustes de la Rifa
                                    </h2>
                                    
                                    <div className="space-y-4">
                                        <div className="bg-green-50 p-3 rounded-lg border border-green-100">
                                            <label className="block text-xs font-bold text-green-800 uppercase">Valor Real del Ticket ($)</label>
                                            <input 
                                                type="number" 
                                                value={ticketValue} 
                                                onChange={(e) => setTicketValue(e.target.value)}
                                                placeholder="0"
                                                className="w-full mt-1 p-2 bg-white border border-green-200 rounded-lg focus:ring-2 focus:ring-green-500 outline-none font-mono text-green-700 font-bold"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 uppercase">T√≠tulo de la Rifa</label>
                                            <input 
                                                type="text" 
                                                value={title} 
                                                onChange={(e) => setTitle(e.target.value)}
                                                className="w-full mt-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 uppercase">Texto del Precio (Imagen)</label>
                                            <input 
                                                type="text" 
                                                value={priceLabel} 
                                                onChange={(e) => setPriceLabel(e.target.value)}
                                                placeholder="Ej: $500 c/u"
                                                className="w-full mt-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 uppercase flex items-center gap-1">
                                                <CreditCard size={12}/> Alias / CBU (Pago)
                                            </label>
                                            <input 
                                                type="text" 
                                                value={bankAlias} 
                                                onChange={(e) => setBankAlias(e.target.value)}
                                                placeholder="Ej: mi.alias.mp"
                                                className="w-full mt-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 uppercase">Fecha y Hora Sorteo</label>
                                            <input 
                                                type="text" 
                                                value={drawDate} 
                                                onChange={(e) => setDrawDate(e.target.value)}
                                                placeholder="Ej: 20 Oct - 8:00 PM"
                                                className="w-full mt-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
                                            />
                                        </div>

                                        <div className="grid grid-cols-2 gap-2">
                                            <div>
                                                <label className="block text-xs font-bold text-gray-500 uppercase">Desde</label>
                                                <input 
                                                    type="number" 
                                                    value={range.min} 
                                                    onChange={(e) => setRange(prev => ({ ...prev, min: parseInt(e.target.value) || 0 }))}
                                                    className="w-full mt-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-xs font-bold text-gray-500 uppercase">Hasta</label>
                                                <input 
                                                    type="number" 
                                                    value={range.max} 
                                                    onChange={(e) => setRange(prev => ({ ...prev, max: parseInt(e.target.value) || 0 }))}
                                                    className="w-full mt-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
                                                />
                                            </div>
                                        </div>

                                        <div className="pt-2 border-t border-gray-100">
                                            <label className="block text-xs font-bold text-gray-500 uppercase mb-2 flex justify-between items-center">
                                                <span>Premios (M√°x 5)</span>
                                                <span className="text-[10px] bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded-full">{prizes.length}/5</span>
                                            </label>
                                            <div className="space-y-2">
                                                {prizes.map((prize, index) => (
                                                    <div key={index} className="flex gap-2">
                                                        <div className="flex-none w-6 h-9 flex items-center justify-center bg-indigo-50 text-indigo-600 font-bold text-xs rounded-lg">
                                                            {index + 1}¬∞
                                                        </div>
                                                        <input 
                                                            type="text" 
                                                            value={prize} 
                                                            onChange={(e) => handlePrizeChange(index, e.target.value)}
                                                            placeholder={`Premio #${index + 1}`}
                                                            className="flex-1 p-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 outline-none"
                                                        />
                                                        <button 
                                                            onClick={() => handleRemovePrize(index)}
                                                            className="text-red-400 hover:text-red-600 hover:bg-red-50 p-1 rounded-md"
                                                            disabled={prizes.length <= 1 && index === 0}
                                                        >
                                                            <Trash2 size={16} />
                                                        </button>
                                                    </div>
                                                ))}
                                                {prizes.length < 5 && (
                                                    <button 
                                                        onClick={handleAddPrize}
                                                        className="w-full py-2 border-2 border-dashed border-indigo-200 text-indigo-500 rounded-lg hover:bg-indigo-50 text-xs font-bold flex items-center justify-center gap-1 transition-colors"
                                                    >
                                                        <Plus size={14} /> Agregar Premio
                                                    </button>
                                                )}
                                            </div>
                                        </div>

                                        <div className="flex gap-2 mt-4 pt-4 border-t border-gray-100">
                                            <input 
                                                type="file" 
                                                ref={fileInputRef} 
                                                onChange={handleImportData} 
                                                accept=".json" 
                                                className="hidden" 
                                            />
                                            <button 
                                                onClick={handleExportData}
                                                className="flex-1 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-xs font-bold flex items-center justify-center gap-1"
                                            >
                                                <Save size={14} /> Guardar
                                            </button>
                                            <button 
                                                onClick={handleImportClick}
                                                className="flex-1 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-xs font-bold flex items-center justify-center gap-1"
                                            >
                                                <Upload size={14} /> Cargar
                                            </button>
                                        </div>

                                        <button 
                                            onClick={handleReset}
                                            className="w-full mt-2 py-2 text-red-500 border border-red-200 rounded-lg hover:bg-red-50 text-xs flex items-center justify-center gap-2 transition-colors"
                                        >
                                            <Trash2 size={14} /> Reiniciar Todo
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* √Årea de Visualizaci√≥n */}
                        <div className="w-full md:w-2/3 flex flex-col items-center">
                            
                            <div className="mb-6 flex gap-2 flex-wrap justify-center w-full">
                                <button 
                                    onClick={() => setViewMode('admin')}
                                    className={`px-4 py-2 rounded-full text-sm font-medium transition-all ${viewMode === 'admin' ? 'bg-indigo-600 text-white shadow-md' : 'bg-white text-gray-600 hover:bg-gray-200'}`}
                                >
                                    Modo Gesti√≥n
                                </button>
                                <button 
                                    onClick={() => setViewMode('preview')}
                                    className={`px-4 py-2 rounded-full text-sm font-medium transition-all ${viewMode === 'preview' ? 'bg-indigo-600 text-white shadow-md' : 'bg-white text-gray-600 hover:bg-gray-200'}`}
                                >
                                    Modo Historia
                                </button>

                                <button 
                                    onClick={handleDownloadImage}
                                    disabled={isDownloading}
                                    className="ml-2 px-5 py-2 rounded-full text-sm font-bold bg-green-600 hover:bg-green-700 text-white shadow-lg flex items-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed transition-all"
                                >
                                    {isDownloading ? (
                                        <>
                                            <Loader2 size={16} className="animate-spin" /> Generando...
                                        </>
                                    ) : (
                                        <>
                                            <Download size={16} /> Descargar Imagen
                                        </>
                                    )}
                                </button>
                            </div>

                            <div 
                                ref={cardRef}
                                data-card-root
                                className="w-full max-w-md bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 p-6 rounded-3xl shadow-2xl relative overflow-hidden"
                            >
                                <div className="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full blur-2xl pointer-events-none transform translate-x-10 -translate-y-10"></div>

                                <div className="bg-white rounded-2xl p-6 min-h-[400px] flex flex-col h-full relative z-10">
                                    <div className="text-center mb-6">
                                        <h1 className="text-3xl font-black text-gray-800 uppercase tracking-tight leading-none break-words">{title}</h1>
                                        {priceLabel && (
                                            <div className="inline-flex items-center justify-center bg-yellow-300 text-yellow-900 font-bold px-4 py-2 rounded-full text-sm mt-3 shadow-md transform -rotate-1 border-2 border-yellow-100">
                                                {priceLabel}
                                            </div>
                                        )}
                                    </div>

                                    <div className="grid grid-cols-5 gap-3 mb-6">
                                        {numbersList.map((num) => {
                                            const isSold = sales[num] !== undefined;
                                            return (
                                                <div 
                                                    key={num}
                                                    onClick={() => handleNumberClick(num)}
                                                    className={`
                                                        aspect-square rounded-xl relative cursor-pointer transition-all duration-200
                                                        ${isSold 
                                                            ? 'bg-red-50 border-2 border-red-400 text-red-400' 
                                                            : 'bg-white border-2 border-gray-200 hover:border-indigo-400 hover:shadow-md text-gray-700'}
                                                    `}
                                                >
                                                    <div className={`center-fix font-bold text-lg ${isSold ? 'opacity-40' : ''}`}>
                                                        {formatNumber(num)}
                                                    </div>
                                                    
                                                    {isSold && (
                                                        <div className="absolute inset-0 flex items-center justify-center animate-in zoom-in duration-200">
                                                            <X className="text-red-600 w-full h-full p-1 opacity-90 drop-shadow-sm" strokeWidth={3} />
                                                        </div>
                                                    )}

                                                    {isSold && viewMode === 'admin' && (
                                                        <div className="absolute -bottom-2 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-[8px] px-1.5 py-0.5 rounded shadow z-10 whitespace-nowrap overflow-hidden max-w-[140%]">
                                                            {sales[num]}
                                                        </div>
                                                    )}
                                                </div>
                                            );
                                        })}
                                    </div>

                                    {prizes.some(p => p.trim() !== "") && (
                                        <div className="mt-auto mb-4 bg-indigo-50/80 rounded-xl p-4 border border-indigo-100">
                                            <h3 className="flex items-center justify-center gap-1.5 font-black text-indigo-800 text-xs uppercase tracking-widest mb-3">
                                                <Trophy size={14} className="text-yellow-600 fill-yellow-500" /> Premios
                                            </h3>
                                            <div className="space-y-2">
                                                {prizes.map((prize, index) => (
                                                    prize.trim() !== "" && (
                                                        <div key={index} className="flex items-start text-sm">
                                                            <span className="font-bold text-indigo-600 min-w-[24px]">{index + 1}¬∞</span>
                                                            <span className="text-gray-800 font-medium leading-tight">{prize}</span>
                                                        </div>
                                                    )
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                    
                                    <div className="mt-2 space-y-2 text-center pb-2">
                                        {bankAlias && (
                                            /* Soluci√≥n ALIAS: Usamos 'flex' + 'mx-auto' en vez de inline-flex.
                                               Fondo gris claro s√≥lido y texto negro forzado. */
                                            <div className="flex items-center justify-center gap-3 bg-gray-100 px-6 py-3 rounded-xl border-2 border-gray-200 mx-auto w-fit max-w-full">
                                                <div className="shrink-0 text-gray-600">
                                                    <CreditCard size={20} />
                                                </div>
                                                <div className="text-left">
                                                    <p className="text-[10px] text-gray-500 uppercase font-bold leading-tight">Alias / CBU</p>
                                                    <p className="text-base font-black text-gray-900 leading-tight break-all">{bankAlias}</p>
                                                </div>
                                            </div>
                                        )}
                                        
                                        {drawDate && (
                                            <div className="block mt-2">
                                                <div className="inline-flex items-center gap-2 bg-gray-800/5 px-3 py-1.5 rounded-full">
                                                    <Calendar size={14} className="text-indigo-600" />
                                                    <span className="text-xs font-bold text-indigo-900 uppercase tracking-wide">Sortea: {drawDate}</span>
                                                </div>
                                            </div>
                                        )}
                                    </div>

                                    <div className="mt-4 text-center text-gray-400 text-xs font-medium pt-2 border-t border-gray-100 pb-2">
                                        ¬°Gracias por participar! üéâ
                                    </div>
                                </div>
                            </div>
                            
                            <p className="mt-4 text-gray-400 text-xs flex items-center gap-1 text-center max-w-sm">
                                <Share2 size={12}/> Abre "Configuraci√≥n" para cambiar precios o datos.
                            </p>
                        </div>
                    </div>

                    {selectedNumber !== null && (
                        <div className="fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
                            <div className="bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden animate-in">
                                <div className="bg-indigo-600 p-4 text-white flex justify-between items-center">
                                    <h3 className="font-bold text-lg">N√∫mero {formatNumber(selectedNumber)}</h3>
                                    <button onClick={() => setSelectedNumber(null)} className="hover:bg-indigo-700 p-1 rounded-full"><X size={20}/></button>
                                </div>
                                
                                <div className="p-6">
                                    <form onSubmit={handleSaveSale}>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Nombre del comprador:</label>
                                        <div className="flex items-center gap-2 mb-6">
                                            <div className="bg-gray-100 p-2 rounded-lg text-gray-500"><User size={20}/></div>
                                            <input
                                                autoFocus
                                                type="text"
                                                value={buyerName}
                                                onChange={(e) => setBuyerName(e.target.value)}
                                                placeholder="Escribe el nombre aqu√≠..."
                                                className="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none text-lg"
                                            />
                                        </div>

                                        <div className="flex gap-3">
                                            {sales[selectedNumber] ? (
                                                <>
                                                    <button 
                                                        type="button" 
                                                        onClick={handleDeleteSale}
                                                        className="flex-1 py-3 bg-red-100 text-red-600 font-bold rounded-xl hover:bg-red-200 transition-colors flex items-center justify-center gap-2"
                                                    >
                                                        <Trash2 size={18} /> Liberar
                                                    </button>
                                                    <button 
                                                        type="submit" 
                                                        className="flex-1 py-3 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700 transition-colors flex items-center justify-center gap-2"
                                                    >
                                                        <Edit3 size={18} /> Actualizar
                                                    </button>
                                                </>
                                            ) : (
                                                <button 
                                                    type="submit" 
                                                    className="w-full py-3 bg-green-600 text-white font-bold rounded-xl hover:bg-green-700 transition-colors shadow-lg shadow-green-200 flex items-center justify-center gap-2"
                                                >
                                                    <Check size={18} /> Marcar como Vendido
                                                </button>
                                            )}
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<RifaApp />);
    </script>
</body>
</html>